<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="《Cmake 实践》笔记">
<meta name="keywords" content="CMAKE">
<meta property="og:type" content="article">
<meta property="og:title" content="Cmake实践-笔记">
<meta property="og:url" content="http://changsk.top/2020/06/25/cmake实践-笔记/index.html">
<meta property="og:site_name" content="changsk&#39;s blogs">
<meta property="og:description" content="《Cmake 实践》笔记">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-06-27T03:22:19.581Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cmake实践-笔记">
<meta name="twitter:description" content="《Cmake 实践》笔记">



  <link rel="alternate" href="/atom.xml" title="changsk's blogs" type="application/atom+xml">




  <link rel="canonical" href="http://changsk.top/2020/06/25/cmake实践-笔记/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Cmake实践-笔记 | changsk's blogs</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">changsk's blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">chang.sk@foxmail.com</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-collection">

    
    
    
      
    

    

    <a href="/collection/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>收藏</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/Tkzccsk" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://changsk.top/2020/06/25/cmake实践-笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="changsk">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/me/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="changsk's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Cmake实践-笔记

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-06-25 19:01:28" itemprop="dateCreated datePublished" datetime="2020-06-25T19:01:28+08:00">2020-06-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-06-27 11:22:19" itemprop="dateModified" datetime="2020-06-27T11:22:19+08:00">2020-06-27</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CMAKE/" itemprop="url" rel="index"><span itemprop="name">CMAKE</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">18k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">16 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>《<strong>Cmake 实践</strong>》笔记</p>
<a id="more"></a>

<ol>
<li><p>Cmake特点</p>
<blockquote>
<p>1，开放源代码，使用类 BSD 许可发布。<br>2，跨平台，并可生成 native 编译配置文件，在 Linux/Unix 平台，生成 makefile，在<br>苹果平台，可以生成 xcode，在 Windows 平台，可以生成 MSVC 的工程文件。<br>3，能够很好的管理大型项目。<br>4，简化编译构建过程和编译过程。Cmake 的工具链非常简单：cmake+make。<br>5，高效虑。<br>6，可扩展，可以为 cmake 编写特定功能的模块，扩充 cmake 功能。</p>
</blockquote>
</li>
<li><p><code>make VERBOSE=1</code>： make 构建的详细过程</p>
</li>
<li><p><code>CMakeLists.txt</code>：文件是 cmake 的构建定义文件，文件名是大小写相关的，如果工程存在多个目录，需要确保每个要管理的目录都存在一个CMakeLists.txt。</p>
</li>
<li><p><code>PROJECT(projectname [CXX] [C] [Java])</code><br>可以用这个指令定义工程名称，并可指定工程支持的语言，支持的语言列表是可以忽略的，<br>默认情况表示支持所有语言。这个指令隐式的定义了两个 cmake 变量:<br><projectname>_BINARY_DIR 以及<projectname>_SOURCE_DIR（如果是内部编译，两个变量目前指的都是工程所在路径）。同时 cmake 系统也帮助我们预定义了 PROJECT_BINARY_DIR 和 PROJECT_SOURCE_DIR变量，他们的值分别跟 <projectname>_BINARY_DIR 和<projectname>_SOURCE_DIR 一致。</projectname></projectname></projectname></projectname></p>
</li>
<li><p><code>SET</code>：SET(VAR [VALUE] [CACHE TYPE DOCSTRING [FORCE]])</p>
<p>如果有多个源文件，也可以定义成：SET(SRC_LIST main.c t1.c t2.c)。</p>
</li>
<li><p><code>MESSAGE</code>：MESSAGE([SEND_ERROR | STATUS | FATAL_ERROR] “message to display” …)<br>这个指令用于向终端输出用户定义的信息，包含了三种类型:</p>
<ul>
<li>SEND_ERROR，产生错误，生成过程被跳过。</li>
<li>SATUS ，输出前缀为 -的信息。</li>
<li>FATAL_ERROR，立即终止所有 cmake 过程.</li>
</ul>
</li>
<li><p><code>ADD_EXECUTABLE</code>：ADD_EXECUTABLE(hello ${SRC_LIST})：定义了这个工程会生成一个文件名为 hello 的可执行文件，相关的源文件是 SRC_LIST 中定义的源文件列表</p>
<blockquote>
<p>注意：如在 IF 控制语句，变量是直接使用变量名引用，而不需要${}</p>
</blockquote>
</li>
<li><p>变量使用${}方式取值，但是在 IF 控制语句中是直接使用变量名</p>
</li>
<li><p>指令是大小写无关的，参数和变量是大小写相关的。推荐全部使用大写指令。</p>
</li>
<li><p>cmake 的语法还是比较灵活而且考虑到各种情况，比如SET(SRC_LIST main.c)也可以写成 SET(SRC_LIST “main.c”)是没有区别的，但是假设一个源文件的文件名是 fu nc.c(文件名中间包含了空格)。这时候就必须使用双引号，如果写成了 SET(SRC_LIST fu nc.c)，就会出现错误，提示你找不到 fu 文件和 nc.c 文件。这种情况，就必须写成:SET(SRC_LIST “fu nc.c”)</p>
</li>
<li><p>可以忽略掉 source 列表中的源文件后缀，比如可以写成ADD_EXECUTABLE(t1 main)，cmake 会自动的在本目录查找 main.c 或者 main.cpp等，当然，最好不要偷这个懒</p>
</li>
<li><p>同时参数也可以使用分号来进行分割。下面的例子也是合法的：<br>ADD_EXECUTABLE(t1 main.c t1.c)可以写成 ADD_EXECUTABLE(t1 main.c;t1.c).<br>注意在编写 CMakeLists.txt 时注意形成统一的风格即可。</p>
</li>
<li><p><code>make clean</code>：清理工程</p>
</li>
<li><p>out-of-source外部构建：，对于原有的工程没有任何影响，所有动作全部发生在编译目录</p>
<blockquote>
<p>mkdir build</p>
<p>cd build</p>
<p>cmake ..</p>
<p>make</p>
</blockquote>
</li>
</ol>
<p>注意：通过外部编译进行工程构建，<projectname>_SOURCE_DIR 仍然指代工程路径，如/backup/cmake/t1<br>而 <projectname>_BINARY_DIR 则指代编译路径，如/backup/cmake/t1/build</projectname></projectname></p>
<ol start="15">
<li><p><code>ADD_SUBDIRECTORY</code>：ADD_SUBDIRECTORY(source_dir [binary_dir] [EXCLUDE_FROM_ALL])</p>
<p>这个指令用于向当前工程添加存放源文件的子目录，并可以指定中间二进制和目标二进制存放的位置。EXCLUDE_FROM_ALL 参数的含义是将这个目录从编译过程中排除，比如，工程的 example，可能就需要工程构建完成后，再进入 example 目录单独进行构建。</p>
<p>ADD_SUBDIRECTORY(src bin)：将 src 子目录加入工程，并指定编译输出(包含编译中间结果)路径为bin 目录。如果不进行 bin 目录的指定，那么编译结果(包括中间结果)都将存放在build/src 目录(这个目录跟原有的 src 目录对应)，指定 bin 目录后，相当于在编译时将 src 重命名为 bin，所有的中间结果和目标二进制都将存放在 bin 目录。</p>
</li>
<li><p>SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)：指定可执行二进制的输出路径<br>SET(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)：指定lib库的输出路径</p>
<blockquote>
<p>在哪里 ADD_EXECUTABLE 或 ADD_LIBRARY，如果需要改变目标存放路径，就在哪里加入上述的定义。</p>
</blockquote>
</li>
<li><p>安装：</p>
<p>make install：将 hello 直接安装到/usr/bin 目录<br>make install DESTDIR=/tmp/test ：安装在/tmp/test/usr/bin 目录<br>CMAKE_INSTALL_PREFIX：cmake -DCMAKE_INSTALL_PREFIX=/usr ..</p>
<p>INSTALL：用于定义安装规则，安装的内容可以包括<strong>目标二进制、动态库、静态库以及文件、目录、脚本</strong>等</p>
<ol>
<li><p>目标文件的安装：</p>
<blockquote>
<p>INSTALL(TARGETS targets…</p>
<pre><code>  [[ARCHIVE|LIBRARY|RUNTIME]
              [DESTINATION &lt;dir&gt;]
              [PERMISSIONS permissions...]
              [CONFIGURATIONS
[Debug|Release|...]]
              [COMPONENT &lt;component&gt;]
              [OPTIONAL]
             ] [...])</code></pre></blockquote>
<p> 参数中的 TARGETS 后面跟的就是通过 ADD_EXECUTABLE 或者 ADD_LIBRARY 定义的目标文件，可能是可执行二进制、动态库、静态库。目标类型也就相对应的有三种，ARCHIVE 特指静态库，LIBRARY 特指动态库，RUNTIME<br> 特指可执行目标二进制。DESTINATION 定义了安装的路径，如果路径以/开头，那么指的是绝对路径，这时候<br> CMAKE_INSTALL_PREFIX 其实就无效了。如果你希望使用 CMAKE_INSTALL_PREFIX 来定义安装路径，就要写成相对路径，即不要以/开头，那么安装后的路径就是${CMAKE_INSTALL_PREFIX}/&lt;DESTINATION 定义的路径&gt;</p>
<p> 举个简单的例子：</p>
<blockquote>
<p>INSTALL(TARGETS myrun mylib mystaticlib<br>RUNTIME DESTINATION bin<br>LIBRARY DESTINATION lib<br>ARCHIVE DESTINATION libstatic<br>)
 上面的例子会将：<br> 可执行二进制 myrun 安装到${CMAKE_INSTALL_PREFIX}/bin 目录<br> 动态库 libmylib 安装到${CMAKE_INSTALL_PREFIX}/lib 目录<br> 静态库 libmystaticlib 安装到${CMAKE_INSTALL_PREFIX}/libstatic 目录</p>
</blockquote>
</li>
<li><p>普通文件的安装：</p>
<blockquote>
<p>  INSTALL(FILES files… DESTINATION <dir></dir></p>
<pre><code>[PERMISSIONS permissions...]
[CONFIGURATIONS [Debug|Release|...]]
[COMPONENT &lt;component&gt;]
[RENAME &lt;name&gt;] [OPTIONAL])</code></pre></blockquote>
</li>
</ol>
<p>可用于安装一般文件，并可以指定访问权限，文件名是此指令所在路径下的相对路径。如果<br>默认不定义权限 PERMISSIONS，安装后的权限为：OWNER_WRITE, OWNER_READ,  GROUP_READ,和     WORLD_READ，即 644 权限。</p>
<p>​         3. 非目标文件的可执行程序安装(比如脚本之类)：</p>
<pre><code>INSTALL(PROGRAMS files... DESTINATION &lt;dir&gt;
     [PERMISSIONS permissions...]
     [CONFIGURATIONS [Debug|Release|...]]
     [COMPONENT &lt;component&gt;]
     [RENAME &lt;name&gt;] [OPTIONAL])</code></pre></li>
</ol>
<p>跟上面的 FILES 指令使用方法一样，唯一的不同是安装后权限为:OWNER_EXECUTE, GROUP_EXECUTE, 和 WORLD_EXECUTE，即 755 权限。</p>
<p>​        4.目录的安装：</p>
<pre><code>&gt;  INSTALL(DIRECTORY dirs... DESTINATION &lt;dir&gt;
&gt;                       [FILE_PERMISSIONS permissions...]
&gt;                       [DIRECTORY_PERMISSIONS permissions...]
&gt;                       [USE_SOURCE_PERMISSIONS]
&gt;                       [CONFIGURATIONS [Debug|Release|...]]
&gt;                       [COMPONENT &lt;component&gt;]
&gt;                       [[PATTERN &lt;pattern&gt; | REGEX &lt;regex&gt;]
&gt;                       [EXCLUDE] [PERMISSIONS permissions...]] [...])</code></pre><p> DIRECTORY 后面连接的是所在 Source 目录的相对路径，但务必注意：abc 和 abc/有很大的区别。如果目录名不以/结尾，那么这个目录将被安装为目标路径下的 abc，如果目录名以/结尾，代表将这个目录中的内容安装到目标路径，<strong>但不包括这个目录本身</strong>。PATTERN 用于使用正则表达式进行过滤，PERMISSIONS 用于指定 PATTERN 过滤后的文件权限。</p>
<ol start="18">
<li><p>SET(LIBRARY_OUTPUT_PATH &lt;路径&gt;)：指定lib库输出路径</p>
</li>
<li><p>ADD_LIBRARY</p>
<blockquote>
<p>ADD_LIBRARY</p>
<pre><code>ADD_LIBRARY(libname    [SHARED|STATIC|MODULE]
  [EXCLUDE_FROM_ALL]
        source1 source2 ... sourceN)</code></pre></blockquote>
<p>不需要写全 libhello.so，只需要填写 hello 即可，cmake 系统会自动生成 libhello.X</p>
<p>类型有三种:<br>SHARED，动态库<br>STATIC，静态库<br>MODULE，在使用 dyld 的系统有效，如果不支持 dyld，则被当作 SHARED 对待。<br>EXCLUDE_FROM_ALL 参数的意思是这个库不会被默认构建，除非有其他的组件依赖或者手工构建。</p>
</li>
<li><p>SET_TARGET_PROPERTIES(target1 target2 …</p>
<pre><code>PROPERTIES prop1 value1
prop2 value2 ...)</code></pre><p>这条指令可以用来设置输出的名称，对于动态库，还可以用来指定动态库版本和 API 版本。</p>
<p>如：SET_TARGET_PROPERTIES(hello_static PROPERTIES OUTPUT_NAME “hello”) 指定静态库hello_static的输出路径为“hello”</p>
<p>GET_TARGET_PROPERTY(OUTPUT_VALUE hello_static OUTPUT_NAME)</p>
</li>
<li><p>cmake 在构建一个新的 target 时，会尝试清理掉其他使用这个名字的库，如在构建 libhello.a 时，就会清理掉 libhello.so.为了回避这个问题，比如再次使用 SET_TARGET_PROPERTIES 定义CLEAN_DIRECT_OUTPUT属性。向 CMakeLists.txt 中添加:<br>SET_TARGET_PROPERTIES(hello PROPERTIES CLEAN_DIRECT_OUTPUT 1)<br>SET_TARGET_PROPERTIES(hello_static PROPERTIES CLEAN_DIRECT_OUTPUT 1)</p>
</li>
<li><p>SET_TARGET_PROPERTIES(hello PROPERTIES VERSION 1.2 SOVERSION 1)<br>VERSION 指代动态库版本，SOVERSION 指代 API 版本。</p>
</li>
<li><p>INCLUDE_DIRECTORIES([AFTER|BEFORE] [SYSTEM] dir1 dir2 …)：这条指令可以用来向工程添加多个特定的头文件搜索路径，路径之间用空格分割，如果路径中包含了空格，可以使用双引号将它括起来，默认的行为是追加到当前的头文件搜索路径的后面，你可以通过两种方式来进行控制搜索路径添加的方式：<br>１，CMAKE_INCLUDE_DIRECTORIES_BEFORE，通过 SET 这个 cmake 变量为 on，可以<br>将添加的头文件搜索路径放在已有路径的前面。<br>２，通过 AFTER 或者 BEFORE 参数，也可以控制是追加还是置前。</p>
</li>
<li><p>为 target 添加共享库：</p>
<p>LINK_DIRECTORIES(directory1 directory2 …)<br>这个指令非常简单，添加非标准的共享库搜索路径，比如，在工程内部同时存在共享库和可执行二进制，在编译时就需要指定一下这些共享库的路径。</p>
<p>TARGET_LINK_LIBRARIES(target library1</p>
<pre><code>&lt;debug | optimized&gt; library2
...)</code></pre><p>这个指令可以用来为 target 添加需要链接的共享库，本例中是一个可执行文件，但是同样可以用于为自己编写的共享库添加共享库链接。</p>
<p>如：TARGET_LINK_LIBRARIES(main hello)，也可以写成TARGET_LINK_LIBRARIES(main libhello.so)</p>
</li>
<li><p>查看可执行程序的链接情况：ldd main</p>
</li>
<li><p>CMAKE_INCLUDE_PATH 和 CMAKE_LIBRARY_PATH</p>
<p><strong>这两个是环境变量而不是 cmake 变量</strong>。使用方法是要在 bash 中用 export 或者在 csh 中使用 set 命令设置或者CMAKE_INCLUDE_PATH=/home/include cmake ..等方式。</p>
<p>export CMAKE_INCLUDE_PATH=/usr/include/hello<br>然后在头文件中将 INCLUDE_DIRECTORIES(/usr/include/hello)替换为：<br>FIND_PATH(myHeader hello.h)<br>IF(myHeader)<br>INCLUDE_DIRECTORIES(${myHeader})<br>ENDIF(myHeader)</p>
<p>FIND_PATH 用来在指定路径中搜索文件名，比如：<br>FIND_PATH(myHeader NAMES hello.h PATHS /usr/include /usr/include/hello)<br>这里没有指定路径，但是，cmake 仍然可以找到 hello.h 存放的路径，就是因为我们设置了环境变量 CMAKE_INCLUDE_PATH。如果你不使用 FIND_PATH，CMAKE_INCLUDE_PATH 变量的设置是没有作用的，你不能指望它会直接为编译器命令添加参数-I<cmake_include_path>。</cmake_include_path></p>
</li>
<li><p>使用${}进行变量的引用。在 IF 等语句中，是直接使用变量名而不通过${}取值</p>
</li>
<li><p>cmake 自定义变量的方式：主要有隐式定义和显式定义两种。隐式定义的例子，就是 PROJECT 指令，他<br>会隐式的定义<projectname>_BINARY_DIR 和<projectname>_SOURCE_DIR 两个变量。<br>显式定义的例子,使用 SET 指令，就可以构建一个自定义变量了。</projectname></projectname></p>
</li>
<li><p>cmake 常用变量：</p>
<ol>
<li>CMAKE_BINARY_DIR、PROJECT_BINARY_DIR、<projectname>_BINARY_DIR，这三个变量指代的内容是一致的，如果是 in source 编译，指得就是工程顶层目录，如果是 out-of-source 编译，指的是工程编译发生的目录。</projectname></li>
<li>CMAKE_SOURCE_DIR、PROJECT_SOURCE_DIR、<projectname>_SOURCE_DIR，这三个变量指代的内容是一致的，不论采用何种编译方式，都是工程顶层目录。</projectname></li>
<li>CMAKE_CURRENT_SOURCE_DIR指的是当前处理的 CMakeLists.txt 所在的路径</li>
<li>CMAKE_CURRRENT_BINARY_DIR，如果是 in-source 编译，它跟 CMAKE_CURRENT_SOURCE_DIR 一致，如果是 out-of-source 编译，则指的是 target 编译目录。使用上面提到的 ADD_SUBDIRECTORY(src bin)可以更改这个变量的值。</li>
<li>CMAKE_CURRENT_LIST_FILE，输出调用这个变量的 CMakeLists.txt 的完整路径</li>
<li>CMAKE_CURRENT_LIST_LINE，输出这个变量所在的行</li>
<li>CMAKE_MODULE_PATH，这个变量用来定义自己的 cmake 模块所在的路径。如果工程比较复杂，有可能会自己编写一些 cmake 模块，这些 cmake 模块是随工程发布的，为了让 cmake 在处CMakeLists.txt 时找到这些模块，需要通过 SET 指令，将自己的 cmake 模块路径设置一下。比如SET(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake)，这时候就可以通过 INCLUDE 指令来调用自己的模块了。</li>
<li>EXECUTABLE_OUTPUT_PATH 和 LIBRARY_OUTPUT_PATH，分别用来重新定义最终可执行二进制文件和库文件的存放目录</li>
<li>PROJECT_NAME，返回通过 PROJECT 指令定义的项目名称。</li>
</ol>
</li>
<li><p>使用$ENV{NAME}指令就可以调用系统的环境变量了。<br>设置环境变量的方式是：SET(ENV{变量名} 值)</p>
<p>CMAKE_INCLUDE_CURRENT_DIR：自动添加 CMAKE_CURRENT_BINARY_DIR 和CMAKE_CURRENT_SOURCE_DIR 到当前处理的 CMakeLists.txt。相当于在每个 CMakeLists.txt 加入：<br>INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_CURRENT_SOURCE_DIR})<br>CMAKE_INCLUDE_DIRECTORIES_PROJECT_BEFORE：将工程提供的头文件目录始终至于系统头文件目录的前面，当你定义的头文件确实跟系统发生冲突时可以提供一些帮助。</p>
</li>
<li><p>系统信息<br>1,CMAKE_MAJOR_VERSION，CMAKE 主版本号<br>2,CMAKE_MINOR_VERSION，CMAKE 次版本号<br>3,CMAKE_PATCH_VERSION，CMAKE 补丁等级<br>4,CMAKE_SYSTEM，系统名称，比如 Linux-2.6.22<br>5,CMAKE_SYSTEM_NAME，不包含版本的系统名，比如 Linux<br>6,CMAKE_SYSTEM_VERSION，系统版本，比如 2.6.22<br>7,CMAKE_SYSTEM_PROCESSOR，处理器名称，比如 i686.<br>8,UNIX，在所有的类 UNIX 平台为 TRUE，包括 OS X 和 cygwin<br>9,WIN32，在所有的 win32 平台为 TRUE，包括 cygwin</p>
</li>
<li><p>主要的开关选项：<br>1，CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS，用来控制 IF ELSE 语句的书写方式<br>2，BUILD_SHARED_LIBS：这个开关用来控制默认的库编译方式，如果不进行设置，使用 ADD_LIBRARY 并没有指定库类型的情况下，默认编译生成的库都是静态库。如果 SET(BUILD_SHARED_LIBS ON)后，默认生成的为动态库。<br>３，CMAKE_C_FLAGS，设置 C 编译选项，也可以通过指令 ADD_DEFINITIONS()添加。<br>4，CMAKE_CXX_FLAGS，设置 C++编译选项，也可以通过指令 ADD_DEFINITIONS()添加。</p>
</li>
<li><p>ADD_DEFINITIONS：向 C/C++编译器添加-D 定义，比如:ADD_DEFINITIONS(-DENABLE_DEBUG  -DABC)，参数之间用空格分割。如果代码中定义了#ifdef ENABLE_DEBUG #endif，这个代码块就会生效。如果要添加其他的编译器开关，可以通过 CMAKE_C_FLAGS 变量和 CMAKE_CXX_FLAGS 变量设置。</p>
<blockquote>
<p>gcc -D 选项</p>
<p>D选项是用来在使用gcc/g++编译的时候定义宏的。</p>
<p>gcc -DDEBUG ：-D 后面直接跟宏命，相当于定义这个宏，默认这个宏的内容是1<br>gcc -DNAME=Peter ：-D 后面跟 key=value 表示定义key这个宏，它的内容是value</p>
</blockquote>
</li>
<li><p>ADD_DEPENDENCIES：定义 target 依赖的其他 target，确保在编译本 target 之前，其他的 target 已经被构<br>建。ADD_DEPENDENCIES(target-name depend-target1 depend-target2 …)</p>
</li>
<li><p>ADD_TEST 与 ENABLE_TESTING 指令。<br>ENABLE_TESTING 指令用来控制 Makefile 是否构建 test 目标，涉及工程所有目录。语<br>法很简单，没有任何参数，ENABLE_TESTING()，一般情况这个指令放在工程的主<br>CMakeLists.txt 中.</p>
<p>ADD_TEST 指令的语法是:<br>ADD_TEST(testname Exename arg1 arg2 …)<br>testname 是自定义的 test 名称，Exename 可以是构建的目标文件也可以是外部脚本等等。后面连接传递给可执行文件的参数。如果没有在同一个 CMakeLists.txt 中打开ENABLE_TESTING()指令，任何 ADD_TEST 都是无效的。</p>
</li>
<li><p>AUX_SOURCE_DIRECTORY<br>基本语法是：<br>AUX_SOURCE_DIRECTORY(dir VARIABLE)<br>作用是发现一个目录下所有的源代码文件并将列表存储在一个变量中，这个指令临时被用来<br>自动构建源文件列表。因为目前 cmake 还不能自动发现新添加的源文件。比如<br>AUX_SOURCE_DIRECTORY(. SRC_LIST)<br>ADD_EXECUTABLE(main ${SRC_LIST})</p>
</li>
<li><p>CMAKE_MINIMUM_REQUIRED<br>其语法为 CMAKE_MINIMUM_REQUIRED(VERSION versionNumber [FATAL_ERROR])<br>比如 CMAKE_MINIMUM_REQUIRED(VERSION 2.5 FATAL_ERROR)<br>如果 cmake 版本小与 2.5，则出现严重错误，整个过程中止。</p>
</li>
<li><p>EXEC_PROGRAM<br>在 CMakeLists.txt 处理过程中执行命令，并不会在生成的 Makefile 中执行。具体语法为：<br>EXEC_PROGRAM(Executable [directory in which to run]</p>
<pre><code>[ARGS &lt;arguments to executable&gt;]
[OUTPUT_VARIABLE &lt;var&gt;]
[RETURN_VALUE &lt;var&gt;])</code></pre><p>用于在指定的目录运行某个程序，通过 ARGS 添加参数，如果要获取输出和返回值，可通过<br>OUTPUT_VARIABLE 和 RETURN_VALUE 分别定义两个变量.这个指令可以帮助你在 CMakeLists.txt 处理过程中支持任何命令，比如根据系统情况去修改代码文件等等。<br>举个简单的例子，我们要在 src 目录执行 ls 命令，并把结果和返回值存下来。可以直接在 src/CMakeLists.txt 中添加：<br>EXEC_PROGRAM(ls ARGS “<em>.c” OUTPUT_VARIABLE LS_OUTPUT RETURN_VALUE LS_RVALUE)<br>IF(not LS_RVALUE)<br>MESSAGE(STATUS “ls result: “ ${LS_OUTPUT})<br>ENDIF(not LS_RVALUE)<br>在 cmake 生成 Makefile 的过程中，就会执行 ls 命令，*</em>如果返回 0，则说明成功执行**，那么就输出 ls *.c 的结果。</p>
</li>
<li><p>FILE 指令<br>文件操作指令，基本语法为:</p>
<pre><code>FILE(WRITE filename &quot;message to write&quot;... )
FILE(APPEND filename &quot;message to write&quot;... )
FILE(READ filename variable)
FILE(GLOB  variable [RELATIVE path] [globbing </code></pre><p>expressions]…)</p>
<pre><code>FILE(GLOB_RECURSE variable [RELATIVE path]
     [globbing expressions]...)
FILE(REMOVE [directory]...)
FILE(REMOVE_RECURSE [directory]...)
FILE(MAKE_DIRECTORY [directory]...)
FILE(RELATIVE_PATH variable directory file)
FILE(TO_CMAKE_PATH path result)
FILE(TO_NATIVE_PATH path result)</code></pre></li>
<li><p>FIND_系列指令主要包含一下指令：<br>FIND_FILE(<var> name1 path1 path2 …)<br>VAR 变量代表找到的文件全路径，包含文件名<br>FIND_LIBRARY(<var> name1 path1 path2 …)<br>VAR 变量表示找到的库全路径，包含库文件名<br>FIND_PATH(<var> name1 path1 path2 …)<br>VAR 变量代表包含这个文件的路径。<br>FIND_PROGRAM(<var> name1 path1 path2 …)<br>VAR 变量代表包含这个程序的全路径。<br>FIND_PACKAGE(<name> [major.minor] [QUIET] [NO_MODULE]</name></var></var></var></var></p>
<pre><code>[[REQUIRED|COMPONENTS] [componets...]])</code></pre><p>用来调用预定义在 CMAKE_MODULE_PATH 下的 Find<name>.cmake 模块，也可以自己<br>定义 Find<name>模块，通过 SET(CMAKE_MODULE_PATH dir)将其放入工程的某个目录<br>中供工程使用<br>FIND_LIBRARY 示例：<br>FIND_LIBRARY(libX X11 /usr/lib)<br>IF(NOT libX)<br>MESSAGE(FATAL_ERROR “libX not found”)<br>ENDIF(NOT libX)</name></name></p>
</li>
<li><p>IF 指令，基本语法为：</p>
<blockquote>
<p>​        IF(expression)<br>​          THEN section.<br>​          COMMAND1(ARGS …)          COMMAND2(ARGS …)<br>​          …<br>​        ELSE(expression)<br>​          ELSE section.<br>​          COMMAND1(ARGS …)<br>​          COMMAND2(ARGS …)<br>​          …<br>​        ENDIF(expression)</p>
</blockquote>
<p>另外一个指令是 ELSEIF，总体把握一个原则，凡是出现 IF 的地方一定要有对应的ENDIF.出现 ELSEIF 的地方，ENDIF 是可选的。<br>表达式的使用方法如下:<br>IF(var)，如果变量不是：<strong>空，0，N, NO, OFF, FALSE, NOTFOUND 或<var>_NOTFOUND</var></strong> 时，表达式为真。<br>IF(NOT var )，与上述条件相反。<br>IF(var1 AND var2)，当两个变量都为真是为真。<br>IF(var1 OR var2)，当两个变量其中一个为真时为真。<br><strong>IF(COMMAND cmd)，当给定的 cmd 确实是命令并可以调用是为真。</strong><br><strong>IF(EXISTS dir)或者 IF(EXISTS file)，当目录名或者文件名存在时为真。</strong><br>IF(file1  IS_NEWER_THAN file2)，当 file1 比 file2 新，或者 file1/file2 其中有一个不存在时为真，文件名请使用完整路径。<br><strong>IF(IS_DIRECTORY dirname)，当 dirname 是目录时，为真。</strong><br>IF(variable MATCHES regex)<br>IF(string MATCHES regex)<br>当给定的变量或者字符串能够匹配正则表达式 regex 时为真。比如：<br>IF(“hello” MATCHES “ell”)<br>MESSAGE(“true”)<br>ENDIF(“hello” MATCHES “ell”)IF(variable LESS number)</p>
<p>IF(string LESS number)<br>IF(variable GREATER number)<br>IF(string GREATER number)<br>IF(variable EQUAL number)<br>IF(string EQUAL number)<br>数字比较表达式</p>
<p>IF(variable STRLESS string)<br>IF(string STRLESS string)<br>IF(variable STRGREATER string)<br>IF(string STRGREATER string)<br>IF(variable STREQUAL string)<br>IF(string STREQUAL string)<br>按照字母序的排列进行比较.</p>
<p><strong>IF(DEFINED variable)，如果变量被定义，为真。</strong><br>一个小例子，用来判断平台差异：<br>IF(WIN32)<br>MESSAGE(STATUS “This is windows.”)<br>#做一些 Windows 相关的操作<br>ELSE(WIN32)<br>MESSAGE(STATUS “This is not windows”)<br>#做一些非 Windows 相关的操作<br>ENDIF(WIN32)<br>上述代码用来控制在不同的平台进行不同的控制，但是，阅读起来却并不是那么舒服，ELSE(WIN32)之类的语句很容易引起歧义。可以打开CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS 开关。<br>可以 SET(CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS ON)<br>这时候就可以写成:<br>IF(WIN32)<br>ELSE()<br>ENDIF()如果配合 ELSEIF 使用，可能的写法是这样:<br>IF(WIN32)<br>#do something related to WIN32<br>ELSEIF(UNIX)<br>#do something related to UNIX<br>ELSEIF(APPLE)<br>#do something related to APPLE<br>ENDIF(WIN32)</p>
</li>
<li><p>WHILE<br>WHILE 指令的语法是：</p>
<pre><code>WHILE(condition)
  COMMAND1(ARGS ...)
  COMMAND2(ARGS ...)
  ...
ENDWHILE(condition)</code></pre><p>其真假判断条件可以参考 IF 指令。</p>
</li>
<li><p>FOREACH<br>FOREACH 指令的使用方法有三种形式：<br>1，列表</p>
<pre><code>FOREACH(loop_var arg1 arg2 ...)
  COMMAND1(ARGS ...)
  COMMAND2(ARGS ...)
  ...
ENDFOREACH(loop_var)</code></pre><p>像前面使用的 AUX_SOURCE_DIRECTORY 的例子<br>AUX_SOURCE_DIRECTORY(. SRC_LIST)<br>FOREACH(F ${SRC_LIST})<br>MESSAGE(${F})<br>ENDFOREACH(F)<br>2，范围<br>FOREACH(loop_var RANGE total)<br>ENDFOREACH(loop_var)<br>从 0 到 total 以１为步进举例如下：<br>FOREACH(VAR RANGE 10)<br>MESSAGE(${VAR})<br>ENDFOREACH(VAR)<br>最终得到的输出是：<br>0
1<br>2
3<br>4
5<br>6
7<br>8
9<br>10<br>３，范围和步进<br>FOREACH(loop_var RANGE start stop [step])<br>ENDFOREACH(loop_var)<br>从 start 开始到 stop 结束，以 step 为步进，<br>举例如下<br>FOREACH(A RANGE 5 15 3)<br>MESSAGE(${A})<br>ENDFOREACH(A)<br>最终得到的结果是：<br>5
8<br>11<br>14<br>这个指令需要注意的是，直到遇到 ENDFOREACH 指令，整个语句块才会得到真正的执行。</p>
</li>
</ol>

      
    </div>

    

    
    
    

    

    
      
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="changsk 微信支付">
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    
      <div>
        



  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>changsk</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="http://changsk.top/2020/06/25/cmake实践-笔记/" title="Cmake实践-笔记">http://changsk.top/2020/06/25/cmake实践-笔记/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CMAKE/" rel="tag"><i class="fa fa-tag"></i> CMAKE</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
            
               <div id="needsharebutton-postbottom">
                 <span class="btn">
                    <i class="fa fa-share-alt" aria-hidden="true"></i>
                 </span>
               </div>
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/06/07/leetcode-721/" rel="next" title="leetcode-721:Accounts Merge(账户合并)">
                <i class="fa fa-chevron-left"></i> leetcode-721:Accounts Merge(账户合并)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/27/shell编程基础/" rel="prev" title="shell编程基础">
                shell编程基础 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/me/me.jpg" alt="changsk">
            
              <p class="site-author-name" itemprop="name">changsk</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">258</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">33</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">111</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Tkzccsk" title="GitHub &rarr; https://github.com/Tkzccsk" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:2486623255@qq.com" title="E-Mail &rarr; mailto:2486623255@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://blog.csdn.net/tkzc_csk" title="CSDN &rarr; https://blog.csdn.net/tkzc_csk" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>CSDN</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">changsk</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">988k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">14:58</span>
  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>



  
  











  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/three/three.min.js"></script>

  
  <script src="/lib/three/three-waves.min.js"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>




  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  


  


  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>
  <script>
    
      pbOptions = {};
      
        pbOptions.iconStyle = "box";
      
        pbOptions.boxForm = "horizontal";
      
        pbOptions.position = "bottomCenter";
      
        pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
        flOptions.iconStyle = "box";
      
        flOptions.boxForm = "horizontal";
      
        flOptions.position = "middleRight";
      
        flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>


  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function(i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
        var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('复制成功');
          else $(this).text('复制失败');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function(e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function() {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


  

</body>
</html>

<script type="text/javascript" src="/js/src/clicklove.js"></script>
